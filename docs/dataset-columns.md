# Dataset Column Reference

**Generated by**: [python-scripts/extract-labeled-dataset.py](../python-scripts/extract-labeled-dataset.py)

---

## Column Order and Descriptions

### CSV Output Format

```csv
timestamp,start_time_ns,end_time_ns,duration_ns,duration_ms,service_name,trace_id,span_id,parent_span_id,span_name,span_kind,http_method,http_status_code,http_target,http_url,anomaly_type,anomaly_label,anomaly_root_cause,anomaly_msg,span_status,span_status_message,net_peer_name,net_peer_port,datacenter
```

---

## Column Definitions

### 1. Temporal Information

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **timestamp** | ISO 8601 | Human-readable timestamp when span started | `2026-01-09T12:25:06.721000` |
| **start_time_ns** | int64 | Span start time in nanoseconds since epoch | `1767979506721000000` |
| **end_time_ns** | int64 | Span end time in nanoseconds since epoch | `1767979506725416048` |
| **duration_ns** | int64 | Span duration in nanoseconds | `4416048` |
| **duration_ms** | float | Span duration in milliseconds | `4.416048` |

**Usage**: The `timestamp` column is in human-readable format for easy filtering and visualization. Use `start_time_ns` and `end_time_ns` for precise time-series analysis.

---

### 2. Service Identification

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **service_name** | string | Name of the microservice that generated this span | `catalogue`, `shipping`, `cart`, `user` |

---

### 3. Trace Structure (MSA Graph)

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **trace_id** | string | Unique identifier for the entire distributed trace | `d2e25fe1443aef81959f63e43e69223c` |
| **span_id** | string | Unique identifier for this specific span | `4805715c8794a873` |
| **parent_span_id** | string | Span ID of the parent (calling) service (empty for root spans) | `be37d6b33c5ebf54` or `` |

**Key Relationships**:
- All spans with the same `trace_id` belong to the same user request
- `parent_span_id` points to the `span_id` of the calling service
- Root spans (entry points) have empty `parent_span_id`

**Example Service Call Chain**:
```
trace_id: abc123
├── web (span_id: s1, parent_span_id: "")         [ROOT]
    ├── catalogue (span_id: s2, parent_span_id: s1)
    └── cart (span_id: s3, parent_span_id: s1)
```

---

### 4. Span Details

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **span_name** | string | Operation or method name | `GET /products`, `tcp.connect`, `db.query` |
| **span_kind** | int | Type of span | `1`=Internal, `2`=Server, `3`=Client, `4`=Producer, `5`=Consumer |

---

### 5. HTTP Request Information

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **http_method** | string | HTTP method | `GET`, `POST`, `PUT`, `DELETE` |
| **http_status_code** | int | HTTP response status code | `200`, `404`, `500` |
| **http_target** | string | Request path | `/products`, `/api/cart/add` |
| **http_url** | string | Full URL (if available) | `http://catalogue:8080/products` |

---

### 6. Anomaly Labels (Research Labels)

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **anomaly_type** | string | Type of anomaly injected | `latency_spike`, `db_exhaustion`, `none` |
| **anomaly_label** | string | Binary classification label | `anomalous` or `normal` |
| **anomaly_root_cause** | string | Root cause of the anomaly | `slow_database`, `connection_pool_exhaustion` |
| **anomaly_msg** | string | Human-readable description | `simulated latency spike`, `baseline healthy traffic` |

**Source**: These are extracted from HTTP headers sent by k6 load test:
```bash
curl -H "x-anomaly-type: latency_spike" \
     -H "x-anomaly-label: anomalous" \
     -H "x-anomaly-root-cause: slow_database" \
     -H "x-anomaly-msg: simulated latency spike" \
     http://localhost:8080/api/catalogue/products
```

---

### 7. Span Status

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **span_status** | int | OpenTelemetry status code | `0`=Unset, `1`=OK, `2`=Error |
| **span_status_message** | string | Error message (if status=Error) | `connection timeout`, `` |

---

### 8. Network Information

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **net_peer_name** | string | Remote service hostname | `mysql`, `mongodb`, `redis` |
| **net_peer_port** | int | Remote service port | `3306`, `27017`, `6379` |

---

### 9. Custom Tags

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **datacenter** | string | Simulated datacenter region | `us-east-1`, `eu-west-1`, `ap-southeast-2` |

**Note**: This is a custom tag added by robot-shop services to simulate distributed deployments.

---

## Example Row

```csv
2026-01-09T12:25:06.721000,1767979506721000000,1767979506725416048,4416048,4.416048,shipping,d2e25fe1443aef81959f63e43e69223c,4805715c8794a873,,GET /health,2,GET,200,/health,,none,normal,none,baseline healthy traffic,0,,,0,us-east-1
```

**Interpretation**:
- **When**: `2026-01-09 12:25:06`
- **Service**: `shipping`
- **Operation**: `GET /health` (health check endpoint)
- **Duration**: `4.4 ms`
- **Status**: HTTP 200 OK, span status 0 (Unset)
- **Trace Context**: Root span (no parent) in trace `d2e25fe1...`
- **Label**: `normal` (baseline healthy traffic)
- **Location**: `us-east-1` datacenter

---

## Usage Examples

### 1. Filter by Timestamp Range

```python
import pandas as pd

df = pd.read_csv('traces_labeled.csv')
df['timestamp'] = pd.to_datetime(df['timestamp'])

# Filter traces from specific time window
time_window = df[(df['timestamp'] >= '2026-01-09 12:00:00') &
                  (df['timestamp'] <= '2026-01-09 13:00:00')]
```

### 2. Reconstruct Service Call Graph

```python
# Get all spans for a specific trace
trace_id = 'd2e25fe1443aef81959f63e43e69223c'
trace_spans = df[df['trace_id'] == trace_id]

# Build parent-child relationships
for _, span in trace_spans.iterrows():
    if span['parent_span_id']:
        parent = trace_spans[trace_spans['span_id'] == span['parent_span_id']]
        print(f"{parent['service_name'].values[0]} → {span['service_name']}")
```

### 3. Analyze Anomalous Patterns

```python
# Compare duration between normal and anomalous spans
normal = df[df['anomaly_label'] == 'normal']['duration_ms']
anomalous = df[df['anomaly_label'] == 'anomalous']['duration_ms']

print(f"Normal avg: {normal.mean():.2f}ms")
print(f"Anomalous avg: {anomalous.mean():.2f}ms")
```

### 4. Time-Series Analysis

```python
# Aggregate by minute
df['minute'] = df['timestamp'].dt.floor('T')
per_minute = df.groupby('minute').agg({
    'duration_ms': ['mean', 'max', 'count'],
    'anomaly_label': lambda x: (x == 'anomalous').sum()
})
```

---

## File Outputs

The extraction script generates:

1. **`traces_labeled_<timestamp>.csv`** - All spans
2. **`traces_normal_<timestamp>.csv`** - Only normal spans
3. **`traces_anomalous_<timestamp>.csv`** - Only anomalous spans
4. **`traces_<anomaly_type>_<timestamp>.csv`** - Per-anomaly-type datasets (e.g., `traces_latency_spike_*.csv`)

---

## Notes

- **Timestamp Precision**: Nanosecond precision preserved in `start_time_ns`/`end_time_ns`
- **Empty Values**: Empty strings (`""`) for missing optional fields
- **Multiple Spans per Trace**: A single trace typically has 1-10 spans depending on service interactions
- **Root vs Child Spans**: Root spans have no parent_span_id and represent the entry point of the request

---

**Last Updated**: 2026-01-09
